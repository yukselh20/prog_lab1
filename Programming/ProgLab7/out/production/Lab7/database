-- Drop existing tables and sequence if they exist, to start fresh
DROP TABLE IF EXISTS tickets;
DROP TABLE IF EXISTS users;
DROP SEQUENCE IF EXISTS tickets_id_seq;

-- Create a sequence for generating unique IDs for the tickets
CREATE SEQUENCE tickets_id_seq
    START WITH 1
    INCREMENT BY 1;

-- Create the users table
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL
);

-- Create the tickets table
CREATE TABLE tickets (
    id INT PRIMARY KEY DEFAULT nextval('tickets_id_seq'),
    obj_key BIGINT UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    coordinates_x FLOAT NOT NULL,
    coordinates_y FLOAT NOT NULL,
    creation_date DATE NOT NULL,
    price INT NOT NULL CHECK (price > 0),
    discount BIGINT NOT NULL CHECK (discount > 0 AND discount <= 100),
    comment VARCHAR(631),
    ticket_type VARCHAR(50) NOT NULL,
    event_name VARCHAR(255),
    event_date TIMESTAMP WITH TIME ZONE,
    event_type VARCHAR(50),
    user_id INT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id)
);